# proxy
代理的主要人物就是转发请求到合适的节点。
代理服务器本地会保存 分片的信息，请求来到后根据分片信息来选择合适的节点 ，将请求转发过去。

## 转发
proxy收到客户的search请求时，会根据请求内是否有指定分布key的值，如果指定了，那么就请求该key对应的分片内的服务器即可.

如果没有指定，则search请求会向所有分片转发请求，并将结果归并。


## 分片信息
proxy的分片信息和和节点信息是通过curl masterservice获得的，这也是master的职责所在。

分片信息和节点信息都是 后台定期更新。

值得一提的是分片信息和节点信息都是 两份，同时有各自的`atomic_index`用来索引当前正在使用的这一份。这样在更新的时候我们会先更新另外一份，然后原子的修改`atomic_index`从而实现原子的更新配置信息，避免了锁的使用。